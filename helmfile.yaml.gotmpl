# rhaii-on-xks - Infrastructure for llm-d on xKS (AKS/CoreWeave)
#
# Usage:
#   helmfile apply                                        # Deploy all operators
#   helmfile apply --selector name=cert-manager-operator  # Deploy only cert-manager
#   helmfile apply --selector name=sail-operator          # Deploy only istio
#   helmfile apply --selector name=lws-operator           # Deploy only lws
#   helmfile destroy                                      # Remove all

environments:
  default:
    values:
      - values.yaml

---

# Import operator helmfiles from local charts
# Note: selectorsInherited=true ensures parent --selector flag filters child releases
helmfiles:
  # cert-manager operator
  - path: charts/cert-manager-operator/helmfile.yaml.gotmpl
    selectorsInherited: true
    values:
      - useSystemPodmanAuth: {{ .Values.useSystemPodmanAuth | default true }}
      - pullSecretFile: {{ .Values.pullSecretFile | default "" | quote }}

  # sail-operator (Istio) - OSSM 3.2.x / Istio 1.27+ with v1 InferencePool API
  - path: charts/sail-operator/helmfile.yaml.gotmpl
    selectorsInherited: true
    values:
      - useSystemPodmanAuth: {{ .Values.useSystemPodmanAuth | default true }}
      - pullSecretFile: {{ .Values.pullSecretFile | default "" | quote }}

  # lws-operator
  - path: charts/lws-operator/helmfile.yaml.gotmpl
    selectorsInherited: true
    values:
      - useSystemPodmanAuth: {{ .Values.useSystemPodmanAuth | default true }}
      - pullSecretFile: {{ .Values.pullSecretFile | default "" | quote }}
